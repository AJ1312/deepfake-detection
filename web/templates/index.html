<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deepfake Origin Finder | Forensic Intelligence Platform</title>
    <link rel="stylesheet" href="/static/css/forensic.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet CSS for Geographic Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Leaflet JS for Geographic Map -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Chart.js for Dashboard Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="forensic-nav">
        <div class="nav-brand">
            <div class="brand-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
            </div>
            <div class="brand-text">
                <span class="brand-name">DEEPFAKE ORIGIN FINDER</span>
                <span class="brand-tagline">Forensic Intelligence Platform</span>
            </div>
        </div>
        <div class="nav-status">
            <div class="status-indicator" id="systemStatus">
                <span class="status-dot"></span>
                <span class="status-text">SYSTEM OPERATIONAL</span>
            </div>
            <div class="blockchain-indicator" id="blockchainStatus">
                <span class="chain-dot"></span>
                <span class="chain-text">POLYGON</span>
            </div>
            <div class="nav-timestamp" id="navTimestamp"></div>
        </div>
        <div class="nav-actions">
            <button class="nav-btn" onclick="showSettings()" title="Settings">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
                Settings
            </button>
            <button class="nav-btn" onclick="showDashboard()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Dashboard
            </button>
            <button class="nav-btn active" onclick="showAnalyze()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                </svg>
                Analyze
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="forensic-main">
        <!-- Journey Progress Indicator -->
        <div class="journey-indicator">
            <div class="journey-step active" data-step="ingest">
                <div class="step-number">01</div>
                <div class="step-label">INGEST</div>
                <div class="step-connector"></div>
            </div>
            <div class="journey-step" data-step="analyze">
                <div class="step-number">02</div>
                <div class="step-label">ANALYZE</div>
                <div class="step-connector"></div>
            </div>
            <div class="journey-step" data-step="attribute">
                <div class="step-number">03</div>
                <div class="step-label">ATTRIBUTE</div>
                <div class="step-connector"></div>
            </div>
            <div class="journey-step" data-step="trace">
                <div class="step-number">04</div>
                <div class="step-label">TRACE</div>
                <div class="step-connector"></div>
            </div>
            <div class="journey-step" data-step="act">
                <div class="step-number">05</div>
                <div class="step-label">ACT</div>
            </div>
        </div>

        <!-- Section: Ingest -->
        <section id="ingestSection" class="forensic-section active">
            <div class="section-header">
                <h2>VIDEO INGESTION</h2>
                <span class="section-badge">EVIDENCE INTAKE</span>
            </div>
            
            <div class="ingest-container">
                <!-- Upload Zone -->
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                    </div>
                    <div class="upload-text">
                        <span class="upload-primary">Drop video file here or click to upload</span>
                        <span class="upload-secondary">Supported formats: MP4, AVI, MOV, MKV, WEBM | Max size: 500MB</span>
                    </div>
                    <input type="file" id="videoInput" accept="video/*" hidden>
                </div>

                <!-- Selected File Info -->
                <div class="selected-file" id="selectedFile" style="display: none;">
                    <div class="file-preview" id="filePreview"></div>
                    <div class="file-info">
                        <span class="file-name" id="fileName"></span>
                        <span class="file-size" id="fileSize"></span>
                    </div>
                    <button class="forensic-btn primary" onclick="startAnalysis()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        BEGIN ANALYSIS
                    </button>
                </div>

                <!-- URL Analysis -->
                <div class="url-analysis-section">
                    <div class="url-divider">
                        <span class="divider-line"></span>
                        <span class="divider-text">OR ANALYZE BY URL</span>
                        <span class="divider-line"></span>
                    </div>
                    <div class="url-input-group">
                        <input type="text" id="videoUrl" placeholder="Paste video URL (YouTube, TikTok, Twitter, etc.)" class="url-input">
                        <button class="forensic-btn primary" onclick="analyzeUrl()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                            </svg>
                            ANALYZE URL
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: Pipeline Visualization -->
        <section id="pipelineSection" class="forensic-section" style="display: none;">
            <div class="section-header">
                <h2>ANALYSIS PIPELINE</h2>
                <span class="section-badge processing">PROCESSING</span>
            </div>
            
            <div class="pipeline-container">
                <div class="pipeline-stage" data-stage="extraction">
                    <div class="stage-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
                            <line x1="7" y1="2" x2="7" y2="22"/>
                            <line x1="17" y1="2" x2="17" y2="22"/>
                            <line x1="2" y1="12" x2="22" y2="12"/>
                            <line x1="2" y1="7" x2="7" y2="7"/>
                            <line x1="2" y1="17" x2="7" y2="17"/>
                            <line x1="17" y1="17" x2="22" y2="17"/>
                            <line x1="17" y1="7" x2="22" y2="7"/>
                        </svg>
                    </div>
                    <div class="stage-info">
                        <span class="stage-name">Frame Extraction</span>
                        <span class="stage-status">Waiting...</span>
                    </div>
                    <div class="stage-progress"><div class="progress-fill"></div></div>
                </div>

                <div class="pipeline-connector"></div>

                <div class="pipeline-stage" data-stage="hashing">
                    <div class="stage-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="4" y1="9" x2="20" y2="9"/>
                            <line x1="4" y1="15" x2="20" y2="15"/>
                            <line x1="10" y1="3" x2="8" y2="21"/>
                            <line x1="16" y1="3" x2="14" y2="21"/>
                        </svg>
                    </div>
                    <div class="stage-info">
                        <span class="stage-name">Perceptual Hashing</span>
                        <span class="stage-status">Waiting...</span>
                    </div>
                    <div class="stage-progress"><div class="progress-fill"></div></div>
                </div>

                <div class="pipeline-connector"></div>

                <div class="pipeline-stage" data-stage="database">
                    <div class="stage-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <ellipse cx="12" cy="5" rx="9" ry="3"/>
                            <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                            <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                        </svg>
                    </div>
                    <div class="stage-info">
                        <span class="stage-name">Database Lookup</span>
                        <span class="stage-status">Waiting...</span>
                    </div>
                    <div class="stage-progress"><div class="progress-fill"></div></div>
                </div>

                <div class="pipeline-connector"></div>

                <div class="pipeline-stage" data-stage="lipsync">
                    <div class="stage-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                            <line x1="12" y1="19" x2="12" y2="23"/>
                            <line x1="8" y1="23" x2="16" y2="23"/>
                        </svg>
                    </div>
                    <div class="stage-info">
                        <span class="stage-name">Lip-Sync Analysis</span>
                        <span class="stage-status">Waiting...</span>
                    </div>
                    <div class="stage-progress"><div class="progress-fill"></div></div>
                </div>

                <div class="pipeline-connector"></div>

                <div class="pipeline-stage" data-stage="verification">
                    <div class="stage-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                            <path d="M2 17l10 5 10-5"/>
                            <path d="M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <div class="stage-info">
                        <span class="stage-name">AI Verification</span>
                        <span class="stage-status">Waiting...</span>
                    </div>
                    <div class="stage-progress"><div class="progress-fill"></div></div>
                </div>

                <div class="pipeline-connector"></div>

                <div class="pipeline-stage" data-stage="origin">
                    <div class="stage-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"/>
                        </svg>
                    </div>
                    <div class="stage-info">
                        <span class="stage-name">Origin Reconstruction</span>
                        <span class="stage-status">Waiting...</span>
                    </div>
                    <div class="stage-progress"><div class="progress-fill"></div></div>
                </div>

                <div class="pipeline-connector"></div>

                <div class="pipeline-stage" data-stage="blockchain">
                    <div class="stage-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                            <line x1="10" y1="6.5" x2="14" y2="6.5"/><line x1="10" y1="17.5" x2="14" y2="17.5"/>
                            <line x1="6.5" y1="10" x2="6.5" y2="14"/><line x1="17.5" y1="10" x2="17.5" y2="14"/>
                        </svg>
                    </div>
                    <div class="stage-info">
                        <span class="stage-name">Blockchain Record</span>
                        <span class="stage-status">Waiting...</span>
                    </div>
                    <div class="stage-progress"><div class="progress-fill"></div></div>
                </div>
            </div>
            
            <!-- Real-time Progress Bar -->
            <div class="pipeline-progress-bar">
                <div class="pipeline-progress-fill" id="pipelineProgressFill" style="width: 0%"></div>
                <div class="pipeline-progress-text" id="pipelineProgressText">Initializing...</div>
            </div>
        </section>

        <!-- Section: Results Workspace -->
        <section id="resultsSection" class="forensic-section" style="display: none;">
            <div class="section-header">
                <h2>ANALYSIS RESULTS</h2>
                <span class="section-badge" id="resultsBadge">VERDICT PENDING</span>
            </div>

            <!-- Duplicate Alert Banner -->
            <div class="duplicate-alert" id="duplicateAlert" style="display: none;">
                <div class="duplicate-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                </div>
                <div class="duplicate-content">
                    <div class="duplicate-title">DUPLICATE VIDEO DETECTED</div>
                    <div class="duplicate-info">
                        <span>This video has been analyzed before.</span>
                        <div class="duplicate-details">
                            <span class="duplicate-first-seen">First seen: <strong id="duplicateFirstSeen">--</strong></span>
                            <span class="duplicate-times">Times analyzed: <strong id="duplicateTimesSeen">--</strong></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="results-container">
                <!-- Verdict Panel -->
                <div class="verdict-panel" id="verdictPanel">
                    <div class="verdict-indicator" id="verdictIndicator">
                        <div class="verdict-ring">
                            <svg viewBox="0 0 100 100">
                                <circle class="ring-bg" cx="50" cy="50" r="45"/>
                                <circle class="ring-fill" id="confidenceRing" cx="50" cy="50" r="45"/>
                            </svg>
                            <div class="verdict-percent" id="verdictPercent">--</div>
                        </div>
                    </div>
                    <div class="verdict-details">
                        <div class="verdict-label" id="verdictLabel">ANALYZING...</div>
                        <div class="verdict-confidence" id="verdictConfidence">Confidence: --</div>
                        <div class="verdict-risk" id="verdictRisk">
                            <span class="risk-badge">Risk Level: --</span>
                        </div>
                    </div>
                </div>

                <!-- Scores Grid -->
                <div class="scores-grid">
                    <div class="score-card">
                        <div class="score-header">
                            <span class="score-icon">üé≠</span>
                            <span class="score-title">LIP-SYNC SCORE</span>
                        </div>
                        <div class="score-value" id="lipsyncScore">--</div>
                        <div class="score-bar">
                            <div class="score-fill" id="lipsyncBar" style="width: 0%"></div>
                        </div>
                        <div class="score-desc">Temporal lip movement consistency</div>
                    </div>

                    <div class="score-card">
                        <div class="score-header">
                            <span class="score-icon">üîç</span>
                            <span class="score-title">FACT CHECK</span>
                        </div>
                        <div class="score-value" id="factCheckScore">--</div>
                        <div class="score-bar">
                            <div class="score-fill" id="factCheckBar" style="width: 0%"></div>
                        </div>
                        <div class="score-desc">External verification signals</div>
                    </div>

                    <div class="score-card">
                        <div class="score-header">
                            <span class="score-icon">üë§</span>
                            <span class="score-title">CELEBRITY</span>
                        </div>
                        <div class="score-value" id="celebrityStatus">--</div>
                        <div class="celebrity-name" id="celebrityName"></div>
                        <div class="score-desc">High-profile target detection</div>
                    </div>

                    <div class="score-card">
                        <div class="score-header">
                            <span class="score-icon">‚è±Ô∏è</span>
                            <span class="score-title">PROCESSING</span>
                        </div>
                        <div class="score-value" id="processingTime">--</div>
                        <div class="score-desc">Total analysis duration</div>
                    </div>
                </div>

                <!-- Evidence Panels -->
                <div class="evidence-panels">
                    <div class="evidence-panel">
                        <div class="panel-header">
                            <span class="panel-icon">üîê</span>
                            <span class="panel-title">HASH SIGNATURES</span>
                            <button class="panel-toggle" onclick="togglePanel(this)">‚ñº</button>
                        </div>
                        <div class="panel-content">
                            <div class="hash-row">
                                <span class="hash-label">Content Hash (SHA256):</span>
                                <code class="hash-value" id="contentHash">--</code>
                            </div>
                            <div class="hash-row">
                                <span class="hash-label">Perceptual Hash (DCT):</span>
                                <code class="hash-value" id="perceptualHash">--</code>
                            </div>
                        </div>
                    </div>

                    <div class="evidence-panel">
                        <div class="panel-header">
                            <span class="panel-icon">üì∞</span>
                            <span class="panel-title">SOURCES FOUND</span>
                            <button class="panel-toggle" onclick="togglePanel(this)">‚ñº</button>
                        </div>
                        <div class="panel-content">
                            <ul class="sources-list" id="sourcesList">
                                <li class="no-sources">No external sources found</li>
                            </ul>
                        </div>
                    </div>

                    <div class="evidence-panel">
                        <div class="panel-header">
                            <span class="panel-icon">üìä</span>
                            <span class="panel-title">ANALYSIS METADATA</span>
                            <button class="panel-toggle" onclick="togglePanel(this)">‚ñº</button>
                        </div>
                        <div class="panel-content">
                            <div class="metadata-grid" id="metadataGrid">
                                <div class="metadata-item">
                                    <span class="meta-label">Method:</span>
                                    <span class="meta-value" id="metaMethod">--</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="meta-label">Agreement:</span>
                                    <span class="meta-value" id="metaAgreement">--</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="meta-label">Timestamp:</span>
                                    <span class="meta-value" id="metaTimestamp">--</span>
                                </div>
                                <div class="metadata-item">
                                    <span class="meta-label">Fact Check:</span>
                                    <span class="meta-value" id="metaFactCheck">--</span>
                                </div>
                                <div class="metadata-item location-item">
                                    <span class="meta-label">üìç Client IP:</span>
                                    <span class="meta-value highlight-ip" id="metaIP">--</span>
                                </div>
                                <div class="metadata-item location-item">
                                    <span class="meta-label">üìç Location:</span>
                                    <span class="meta-value" id="metaLocation">--</span>
                                </div>
                                <div class="metadata-item location-item">
                                    <span class="meta-label">üìç Coordinates:</span>
                                    <span class="meta-value" id="metaCoords">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Deep Learning Analysis Panel -->
                <div class="evidence-panel scoring-intelligence">
                    <div class="panel-header highlight-header">
                        <span class="panel-icon">üß†</span>
                        <span class="panel-title">DEEP LEARNING ANALYSIS</span>
                        <span class="panel-badge novel">CNN MODEL</span>
                        <button class="panel-toggle" onclick="togglePanel(this)">‚ñº</button>
                    </div>
                    <div class="panel-content">
                        <!-- Main CNN Analysis Display -->
                        <div class="cnn-analysis-main">
                            <div class="cnn-score-display">
                                <div class="cnn-ring">
                                    <svg viewBox="0 0 100 100">
                                        <circle class="ring-bg" cx="50" cy="50" r="40" fill="none" stroke="#2a2a4a" stroke-width="8"/>
                                        <circle class="ring-fill" id="cnnRingFill" cx="50" cy="50" r="40" fill="none" stroke="#00ff88" stroke-width="8" stroke-dasharray="251.3" stroke-dashoffset="251.3" transform="rotate(-90 50 50)"/>
                                    </svg>
                                    <div class="cnn-score-value" id="cnnScoreValue">--</div>
                                </div>
                                <div class="cnn-score-label">CNN Deepfake Score</div>
                            </div>
                            <div class="cnn-details">
                                <div class="detail-row">
                                    <span class="detail-label">üé≠ Lip-Sync Analysis:</span>
                                    <span class="detail-value" id="detailLipsync">--</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">üé¨ Frame Consistency:</span>
                                    <span class="detail-value" id="detailFrames">--</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">üë§ Face Artifacts:</span>
                                    <span class="detail-value" id="detailArtifacts">--</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">üîä Audio-Visual Sync:</span>
                                    <span class="detail-value" id="detailAVSync">--</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detection Heatmap -->
                        <div class="heatmap-section">
                            <h4 class="heatmap-title">üìä Detection Heatmap</h4>
                            <div class="heatmap-container" id="heatmapContainer">
                                <canvas id="heatmapCanvas" width="400" height="120"></canvas>
                                <div class="heatmap-legend">
                                    <span class="legend-low">Low Risk</span>
                                    <span class="legend-medium">Medium</span>
                                    <span class="legend-high">High Risk</span>
                                </div>
                            </div>
                            <div class="heatmap-info" id="heatmapInfo">
                                <span>Hover over regions to see frame-level analysis</span>
                            </div>
                        </div>
                        
                        <!-- Scoring Breakdown -->
                        <div class="scoring-breakdown">
                            <div class="breakdown-item">
                                <div class="breakdown-header">
                                    <span class="breakdown-label">ü§ñ CNN Model Confidence</span>
                                    <span class="breakdown-value" id="cnnModelConf">--</span>
                                </div>
                                <div class="breakdown-bar">
                                    <div class="breakdown-fill" id="cnnModelBar" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-header">
                                    <span class="breakdown-label">üé≠ Temporal Consistency</span>
                                    <span class="breakdown-value" id="temporalConf">--</span>
                                </div>
                                <div class="breakdown-bar">
                                    <div class="breakdown-fill" id="temporalBar" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-header">
                                    <span class="breakdown-label">üîç Artifact Detection</span>
                                    <span class="breakdown-value" id="artifactConf">--</span>
                                </div>
                                <div class="breakdown-bar">
                                    <div class="breakdown-fill" id="artifactBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="scoring-explanation">
                            <p><strong>How it works:</strong> Our CNN-based deep learning model analyzes facial movements, 
                            lip synchronization, and temporal consistency across video frames. The heatmap shows 
                            detection confidence across the video timeline.</p>
                        </div>
                    </div>
                </div>

                <!-- Trust Indicators -->
                <div class="trust-indicators" id="trustIndicators">
                    <!-- Dynamically populated -->
                </div>

                <!-- Blockchain Verification Panel -->
                <div class="evidence-panel blockchain-panel">
                    <div class="panel-header blockchain-header">
                        <span class="panel-icon">‚õìÔ∏è</span>
                        <span class="panel-title">BLOCKCHAIN VERIFICATION</span>
                        <span class="panel-badge novel">ON-CHAIN</span>
                        <button class="panel-toggle" onclick="togglePanel(this)">‚ñº</button>
                    </div>
                    <div class="panel-content">
                        <div class="blockchain-info-grid">
                            <div class="bc-info-row">
                                <span class="bc-label">Transaction Hash:</span>
                                <a class="bc-value bc-tx-hash" id="bcTxHash" href="#" target="_blank">--</a>
                            </div>
                            <div class="bc-info-row">
                                <span class="bc-label">Block Number:</span>
                                <span class="bc-value" id="bcBlockNumber">--</span>
                            </div>
                            <div class="bc-info-row">
                                <span class="bc-label">Network:</span>
                                <span class="bc-value bc-network" id="bcNetwork">Polygon Amoy Testnet</span>
                            </div>
                            <div class="bc-info-row">
                                <span class="bc-label">Contract:</span>
                                <span class="bc-value bc-contract" id="bcContract">--</span>
                            </div>
                            <div class="bc-info-row">
                                <span class="bc-label">Status:</span>
                                <span class="bc-value bc-status" id="bcStatus">
                                    <span class="bc-status-dot"></span> Pending
                                </span>
                            </div>
                        </div>
                        <div class="bc-verify-btn-wrap">
                            <a class="forensic-btn secondary bc-explorer-btn" id="bcExplorerLink" href="#" target="_blank">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/>
                                </svg>
                                View on PolygonScan
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: Genealogy Graph -->
        <section id="genealogySection" class="forensic-section" style="display: none;">
            <div class="section-header">
                <h2>LINEAGE GENEALOGY</h2>
                <span class="section-badge">ORIGIN TRACKING</span>
            </div>

            <div class="genealogy-container">
                <div class="genealogy-controls">
                    <button class="control-btn" onclick="zoomIn()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
                            <line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/>
                        </svg>
                    </button>
                    <button class="control-btn" onclick="zoomOut()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
                            <line x1="8" y1="11" x2="14" y2="11"/>
                        </svg>
                    </button>
                    <button class="control-btn" onclick="resetView()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="1 4 1 10 7 10"/><polyline points="23 20 23 14 17 14"/>
                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                        </svg>
                    </button>
                </div>
                <div class="genealogy-graph" id="genealogyGraph">
                    <div class="graph-placeholder">
                        <span>No lineage data available</span>
                        <span class="placeholder-sub">Analyze a video to see its genealogy</span>
                    </div>
                </div>
                <div class="genealogy-legend">
                    <div class="legend-item">
                        <span class="legend-dot origin"></span>
                        <span>Origin</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot deepfake"></span>
                        <span>Confirmed Deepfake</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot authentic"></span>
                        <span>Authentic</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-dot current"></span>
                        <span>Current Analysis</span>
                    </div>
                </div>
            </div>

            <!-- Spread Timeline -->
            <div class="spread-timeline" id="spreadTimeline">
                <div class="timeline-header">
                    <h3>SPREAD TIMELINE</h3>
                </div>
                <div class="timeline-content" id="timelineContent">
                    <!-- Dynamically populated -->
                </div>
            </div>
        </section>

        <!-- Section: Geographic Spread Map -->
        <section id="geoMapSection" class="forensic-section" style="display: none;">
            <div class="section-header">
                <h2>GEOGRAPHIC SPREAD</h2>
                <span class="section-badge">LOCATION TRACKING</span>
            </div>

            <div class="geo-map-container">
                <div class="geo-stats" id="geoStats">
                    <div class="geo-stat-card">
                        <div class="stat-value" id="totalLocations">0</div>
                        <div class="stat-label">Total Locations</div>
                    </div>
                    <div class="geo-stat-card">
                        <div class="stat-value" id="uniqueCountries">0</div>
                        <div class="stat-label">Countries</div>
                    </div>
                    <div class="geo-stat-card">
                        <div class="stat-value" id="originCount">0</div>
                        <div class="stat-label">Origin Points</div>
                    </div>
                    <div class="geo-stat-card">
                        <div class="stat-value" id="spreadCount">0</div>
                        <div class="stat-label">Spread Events</div>
                    </div>
                </div>

                <div class="geo-map-wrapper">
                    <div id="spreadMap" style="height: 450px; width: 100%; border-radius: 8px; background: #1a1a2e;"></div>
                </div>

                <div class="geo-legend">
                    <div class="legend-item">
                        <span class="legend-marker origin-marker"></span>
                        <span>Origin - Deepfake</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-marker origin-authentic-marker"></span>
                        <span>Origin - Authentic</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-marker spread-marker"></span>
                        <span>Spread - Deepfake</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-marker spread-authentic-marker"></span>
                        <span>Spread - Authentic</span>
                    </div>
                </div>

                <div class="geo-countries-list" id="countriesList">
                    <h4>AFFECTED COUNTRIES</h4>
                    <div class="countries-grid" id="countriesGrid">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Section: Actions -->
        <section id="actionsSection" class="forensic-section" style="display: none;">
            <div class="section-header">
                <h2>ACTIONS</h2>
                <span class="section-badge">RESPONSE OPTIONS</span>
            </div>

            <div class="actions-container">
                <div class="action-card" onclick="flagForReview()">
                    <div class="action-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/>
                            <line x1="4" y1="22" x2="4" y2="15"/>
                        </svg>
                    </div>
                    <div class="action-info">
                        <span class="action-title">Flag for Platform Review</span>
                        <span class="action-desc">Submit to social media platforms for content moderation</span>
                    </div>
                </div>

                <div class="action-card" onclick="generateReport()">
                    <div class="action-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10 9 9 9 8 9"/>
                        </svg>
                    </div>
                    <div class="action-info">
                        <span class="action-title">Generate Legal Evidence Report</span>
                        <span class="action-desc">Create exportable forensic documentation for legal proceedings</span>
                    </div>
                </div>

                <div class="action-card" onclick="monitorDerivatives()">
                    <div class="action-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                            <circle cx="12" cy="12" r="3"/>
                        </svg>
                    </div>
                    <div class="action-info">
                        <span class="action-title">Monitor Derivative Activity</span>
                        <span class="action-desc">Track re-uploads and mutations across platforms</span>
                    </div>
                </div>

                <div class="action-card" onclick="shareProvenance()">
                    <div class="action-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="18" cy="5" r="3"/>
                            <circle cx="6" cy="12" r="3"/>
                            <circle cx="18" cy="19" r="3"/>
                            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                        </svg>
                    </div>
                    <div class="action-info">
                        <span class="action-title">Share Provenance Summary</span>
                        <span class="action-desc">Generate shareable lineage documentation for journalists</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboardSection" class="forensic-section" style="display: none;">
            <div class="section-header">
                <h2>INTELLIGENCE DASHBOARD</h2>
                <span class="section-badge">OVERVIEW</span>
            </div>

            <div class="dashboard-container">
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-value" id="statTotalAnalyzed">0</div>
                        <div class="stat-label">Videos Analyzed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statDeepfakesFound">0</div>
                        <div class="stat-label">Deepfakes Detected</div>
                    </div>
                    <div class="stat-card stat-card-accent">
                        <div class="stat-value" id="statBlockchainTx">0</div>
                        <div class="stat-label">Blockchain TXs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statCacheHitRate">0%</div>
                        <div class="stat-label">Cache Hit Rate</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statFamiliesTracked">0</div>
                        <div class="stat-label">Families Tracked</div>
                    </div>
                    <div class="stat-card stat-card-danger">
                        <div class="stat-value" id="statThreats">0</div>
                        <div class="stat-label">Active Threats</div>
                    </div>
                </div>

                <div class="dashboard-panels">
                    <!-- Recent Detections Table -->
                    <div class="dash-panel dash-panel-wide">
                        <h3>RECENT DETECTIONS</h3>
                        <div class="detection-table-wrap">
                            <table class="detection-table" id="recentDetectionsTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>File</th>
                                        <th>Verdict</th>
                                        <th>Confidence</th>
                                        <th>Risk</th>
                                        <th>Time</th>
                                        <th>Location</th>
                                    </tr>
                                </thead>
                                <tbody id="recentDetectionsBody">
                                    <tr class="empty-row">
                                        <td colspan="7" class="empty-state">No recent detections</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Platform Distribution Chart -->
                    <div class="dash-panel">
                        <h3>PLATFORM DISTRIBUTION</h3>
                        <div class="chart-container">
                            <canvas id="platformChartCanvas"></canvas>
                        </div>
                    </div>

                    <!-- Threat Activity Chart -->
                    <div class="dash-panel">
                        <h3>DETECTION ACTIVITY</h3>
                        <div class="chart-container">
                            <canvas id="activityChartCanvas"></canvas>
                        </div>
                    </div>

                    <!-- Blockchain Transactions -->
                    <div class="dash-panel dash-panel-wide">
                        <h3>‚õìÔ∏è RECENT BLOCKCHAIN TRANSACTIONS</h3>
                        <div class="detection-table-wrap">
                            <table class="detection-table blockchain-table" id="blockchainTxTable">
                                <thead>
                                    <tr>
                                        <th>TX Hash</th>
                                        <th>Block</th>
                                        <th>Action</th>
                                        <th>Video</th>
                                        <th>Result</th>
                                        <th>Gas</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="blockchainTxBody">
                                    <tr class="empty-row">
                                        <td colspan="7" class="empty-state">No blockchain transactions</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Network Status -->
                    <div class="dash-panel">
                        <h3>üåê NETWORK STATUS</h3>
                        <div class="network-status-grid">
                            <div class="network-node">
                                <div class="node-status-dot online"></div>
                                <div class="node-info">
                                    <span class="node-name">Main Server</span>
                                    <span class="node-detail">Flask API :5001</span>
                                </div>
                            </div>
                            <div class="network-node">
                                <div class="node-status-dot online"></div>
                                <div class="node-info">
                                    <span class="node-name">Polygon RPC</span>
                                    <span class="node-detail">Amoy Testnet</span>
                                </div>
                            </div>
                            <div class="network-node">
                                <div class="node-status-dot" id="nodeGeminiDot"></div>
                                <div class="node-info">
                                    <span class="node-name">Gemini AI</span>
                                    <span class="node-detail" id="nodeGeminiDetail">Checking...</span>
                                </div>
                            </div>
                            <div class="network-node">
                                <div class="node-status-dot online"></div>
                                <div class="node-info">
                                    <span class="node-name">Edge Nodes</span>
                                    <span class="node-detail">Pi + Laptop P2P</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- System Performance -->
                    <div class="dash-panel">
                        <h3>üìà SYSTEM METRICS</h3>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <span class="metric-label">Avg Processing Time</span>
                                <span class="metric-value" id="metricAvgTime">--</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Detection Rate</span>
                                <span class="metric-value" id="metricDetectionRate">--</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Model Accuracy</span>
                                <span class="metric-value">94.7%</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Uptime</span>
                                <span class="metric-value" id="metricUptime">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è System Settings</h3>
                <button class="modal-close" onclick="hideSettings()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>üîë Gemini API Configuration</h4>
                    <p class="settings-desc">Enter your Google Gemini API key to enable AI-powered fact-checking and deepfake verification.</p>
                    <div class="input-group">
                        <label for="geminiApiKey">API Key</label>
                        <input type="password" id="geminiApiKey" placeholder="Enter your Gemini API key..." class="settings-input">
                        <button class="btn-toggle-visibility" onclick="toggleApiKeyVisibility()">üëÅ</button>
                    </div>
                    <button class="btn-primary" onclick="saveGeminiApiKey()">Save API Key</button>
                    <div class="settings-status" id="geminiStatus">
                        <span class="status-indicator" id="geminiStatusIndicator">‚óè</span>
                        <span id="geminiStatusText">Not configured</span>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>üìä System Status</h4>
                    <div class="status-grid">
                        <div class="status-item">
                            <span class="status-label">Detection Engine</span>
                            <span class="status-value" id="statusDetector">Checking...</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">PyTorch</span>
                            <span class="status-value" id="statusTorch">Checking...</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Hash Cache</span>
                            <span class="status-value" id="statusHashCache">Checking...</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Gemini API</span>
                            <span class="status-value" id="statusGemini">Checking...</span>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>‚õìÔ∏è Blockchain Configuration</h4>
                    <div class="status-grid">
                        <div class="status-item">
                            <span class="status-label">Network</span>
                            <span class="status-value ready" id="statusBlockchainNetwork">Polygon Amoy</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Chain ID</span>
                            <span class="status-value ready">80002</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Connection</span>
                            <span class="status-value" id="statusBlockchainConn">Checking...</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Total TXs</span>
                            <span class="status-value" id="statusBlockchainTxCount">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
        </div>
        <div class="loading-text">Processing...</div>
    </div>

    <script src="/static/js/forensic.js"></script>
</body>
</html>
